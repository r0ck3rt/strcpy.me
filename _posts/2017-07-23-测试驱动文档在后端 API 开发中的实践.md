---
id: 772
layout: post
title: 'æµ‹è¯•é©±åŠ¨æ–‡æ¡£åœ¨åç«¯ API å¼€å‘ä¸­çš„å®è·µ'
date: 2017-07-23 12:39:07
author: virusdefender
tags: Django
---

å¾ˆå¤šäººäº†è§£è¿‡ [Python çš„ doctest](https://docs.python.org/2/library/doctest.html)ï¼Œæ˜¯ä»æ³¨é‡Šä¸­å†™æµ‹è¯•ï¼Œæˆ‘ä»¬ç°åœ¨åå‘æ€ç»´ï¼Œä»æµ‹è¯•ç”Ÿæˆæ–‡æ¡£ã€‚

## ç°çŠ¶

åœ¨å¼€å¤´æœ‰å¿…è¦è¯´æ˜ä¸€ä¸‹ç°åœ¨åç«¯ API çš„å¼€å‘æ¨¡å¼ï¼Œè¿™æ ·æ‰èƒ½æ›´å¥½çš„ç†è§£é‡åˆ°çš„é—®é¢˜ã€‚

 - æ¡†æ¶: Django
 - ç»™å‰ç«¯æä¾›çš„éƒ½æ˜¯ JSON APIï¼Œæ²¡æœ‰åç«¯æ¸²æŸ“çš„ç½‘é¡µ
 - æ‰€æœ‰çš„ API éƒ½ç»§æ‰¿ `APIView`ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯ Django REST frameworkï¼ˆä»¥ä¸‹ç®€ç§° DRFï¼Œåå­—å¤ªé•¿äº†ï¼‰ ä¸­çš„ `APIView`ï¼Œè¿™ä¸ªåé¢ä¼šè¯´åŸå› 
 - ä½¿ç”¨ DRF ä¸­çš„éƒ¨åˆ† serializer æ¥åšæ•°æ®æ ¼å¼éªŒè¯å’Œ QuerySet è½¬æ¢ä¸º Python å­—å…¸åˆ—è¡¨ç­‰ç±»å‹çš„å·¥ä½œ

DRF åº“æä¾›äº†å¾ˆå¤šæˆ‘ä»¬å¹¶ä¸ä¼šç”¨åˆ°çš„åŠŸèƒ½ï¼Œæ¯”å¦‚
  
- ç™»å½•éªŒè¯ï¼Œæƒé™ç®¡ç†ï¼ŒAPI ç‰ˆæœ¬å·ç®¡ç†ï¼Œé™æµã€è‡ªåŠ¨ç¿»é¡µç­‰ç­‰ï¼Œè¿™äº›æˆ‘ä»¬æ›´ä¾§é‡ç‹¬ç«‹å’Œæ‰‹åŠ¨çš„å¤„ç†ã€‚
- `Generic Views` ä¸€ç›´æ˜¯ä¸€ä¸ªè®©æˆ‘æ„Ÿåˆ°ç–‘æƒ‘çš„ä¸œè¥¿ï¼Œçœ‹ä¼¼å†™èµ·æ¥ç®€å•ï¼Œä»£ç é‡å¾ˆå°‘ï¼Œåƒæ˜¯å¡«å……ä¸€äº›é¢„å®šä¹‰çš„å˜é‡å’Œæ–¹æ³•ï¼Œç®€å•çš„å¢åˆ æŸ¥æ”¹ä¼šæ–¹ä¾¿ä¸€ç‚¹ï¼Œä½†æ˜¯åœ¨å®é™…å¤æ‚çš„ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œå¯èƒ½å¯¼è‡´é—®é¢˜å¤æ‚åŒ–ï¼Œå¹¶æ²¡æœ‰æ˜¾å¼çš„å†™å‡ºæ“ä½œè¿‡ç¨‹æ›´æ¸…æ™°ã€‚

æ‰€ä»¥æˆ‘ä»¬ä»¿ç…§ DRF çš„ APIViewï¼Œç»§æ‰¿ Django çš„ View,è‡ªå·±å†™äº†ä¸€ä¸ªæ–°çš„ `APIView`ï¼ŒåŒ…å«äº†æ ¸å¿ƒåŠŸèƒ½ï¼Œè§£æ JSONï¼ŒåŒæ—¶å¢åŠ äº†éƒ¨åˆ†å¸¸ç”¨æ–¹æ³•ï¼Œæ¯”å¦‚ `validate_serializer`ã€`self.success`ã€`self.error` å’Œ `self.paginate` ç­‰ç­‰ã€‚

ä¸‹é¢æ˜¯ä¸€æ®µä¼ªä»£ç 

```python
class UserProfileAPI(APIView):
    @validate_serializer(ChangeUserProfileSeralizer)
    def put(self):
        ....
        if err:
            return self.error("ä¿å­˜å¤±è´¥")
        return self.success(UserProfileSerailzier(user_profile).data)

class ProblemAPI(APIView):
    def get(self):
        return self.success(self.paginate(request, Problem.objects.all(), ProblemSerializer)))
```

## ç°æœ‰çš„æ–‡æ¡£å­˜åœ¨ä»€ä¹ˆé—®é¢˜

  - æ²¡æœ‰æ–‡æ¡£ï¼Œé "å£å£ç›¸ä¼ "å’Œ"å¿ƒæœ‰çµçŠ€"ã€‚
  - æ‰‹å†™ API æ–‡æ¡£ï¼Œä¸åŒäººå†™å‡ºæ¥çš„å¯èƒ½æ ¼å¼é£æ ¼ç•¥æœ‰å·®å¼‚ï¼Œä¹Ÿä¸å®¹æ˜“ç»Ÿä¸€ç®¡ç†ã€‚æ›´é‡è¦çš„æ˜¯äººéƒ½æ˜¯æ‡’çš„ï¼Œæ²¡æœ‰ç›‘ç£çš„æƒ…å†µä¸‹ï¼Œæ–‡æ¡£èƒ½ä¸å†™å°±ä¸å†™ï¼Œè€Œæµ‹è¯•è¿˜æ˜¯è¦å¿…é¡»è¦å†™çš„ã€‚
  - ä¸€å¤„ä¿®æ”¹å¾ˆå¤š API å¯èƒ½éƒ½ä¼šå˜ï¼Œæ¯”å¦‚æŸä¸€ä¸ª Model ä¿®æ”¹äº†å­—æ®µï¼Œå¾ˆå¤š API çš„è¿”å›å€¼éƒ½å¯èƒ½å—åˆ°å½±å“ï¼Œæ‰‹åŠ¨çš„é€ä¸ªä¿®æ”¹å¹¶ä¸ç§‘å­¦ã€‚
  - å·²æœ‰çš„æ–‡æ¡£ç”Ÿæˆå·¥å…·è‡ªå®šä¹‰ç¨‹åº¦ä¸é«˜ï¼Œæ¯”å¦‚ [Django REST Swagger](https://github.com/marcgibbons/django-rest-swagger) è¦æ±‚ `Generic Views` å°±æ”¾å¼ƒäº†ã€‚
  - è¿˜æœ‰äº›æ–‡æ¡£ç”Ÿæˆå·¥å…·æ˜¯åœ¨æ³¨é‡Šä¸­ä½¿ç”¨ç‰¹å®šçš„æ ¼å¼æè¿° API å­—æ®µå’Œç»†èŠ‚çš„ï¼Œå…¶å®å’Œæ‰‹å†™æ–‡æ¡£æ²¡æœ‰æœ¬è´¨ä¸Šçš„å·®å¼‚ã€‚
  - ä¸Šé¢å‡ æ¡æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼šæ‰‹å†™çš„æ–‡æ¡£å¾ˆéš¾è‡ªåŠ¨åŒ–éªŒè¯æ˜¯å¦æ­£ç¡®ï¼Œæµ‹è¯•ç”Ÿæˆæ–‡æ¡£å¯ä»¥ä¿è¯å’Œæµ‹è¯•æ˜¯ä¸€è‡´çš„ã€‚
  - è™½ç„¶"ä»£ç å³æ–‡æ¡£"ï¼Œä½†æ˜¯ä¹Ÿåªé€‚ç”¨äºé API æ–‡æ¡£ï¼Œæ¯”å¦‚æ•°æ®åº“è®¾è®¡ã€æ¶æ„è®¾è®¡ã€ç®—æ³•è®¾è®¡ç­‰ï¼Œå› ä¸ºä»£ç å¹¶ä¸ä¸€å®šé€‚åˆä¼ æ’­ç»™æ‰€æœ‰äººçœ‹ï¼Œå°¤å…¶æ˜¯ API æ–‡æ¡£ä¸€èˆ¬éƒ½æ˜¯å¯¹å¤–çš„ï¼Œè€Œä¸”ä»£ç ä¸­çš„æ³¨é‡Šç»å¸¸æ˜¯åˆ†æ•£çš„ï¼Œæ–‡æ¡£ä¸Šä¸€ä¸ª API çš„è¯´æ˜ã€è¯·æ±‚ã€å“åº”ç­‰å‡ éƒ¨åˆ†æ•°æ®å¯èƒ½åˆ†æ•£åœ¨å‡ ä¸ªæ–‡ä»¶ä¸­ã€‚

## æˆ‘ä»¬çš„å®è·µ

è¦æ”¹è¿›ä¸Šé¢çš„é—®é¢˜ï¼ŒåŸºæœ¬åŸåˆ™æ˜¯å°½é‡å°‘æ”¹åŠ¨å·²æœ‰çš„ä»£ç ï¼Œæ‰€ä»¥ç»è¿‡å’Œ @reverland çš„ä¸€ç•ªè®¨è®ºï¼Œç¡®å®šä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•ï¼š

 - ä½¿ç”¨ serializer ç”Ÿæˆæ•°æ®æ ¼å¼æè¿°æ€§æ–‡æ¡£
 - ä½¿ç”¨éƒ¨åˆ†æµ‹è¯•å……å½“ API æ ·ä¾‹æ•°æ®
 - CI çš„æ—¶å€™ï¼Œè¯†åˆ« commit ä¿¡æ¯ä¸­çš„`doc deploy` åç”Ÿæˆå’Œè‡ªåŠ¨éƒ¨ç½²æ–‡æœ¬ç‰ˆæ–‡æ¡£å’Œ Postman å¯¼å‡ºæ ¼å¼

### serializer çš„æ–‡æ¡£

ç”±ä¸€ä¸ª serializer ç”Ÿæˆå¯¹åº”çš„æè¿°æ€§æ–‡æ¡£ç›¸å¯¹æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œä¸€ä¸ªå…¸å‹çš„ serializer æ˜¯è¿™æ ·çš„

```python
class IPOrSubnetField(serializers.CharField):
    def __init__(self, **kwargs):
        super().__init__(**kwargs)
        if not kwargs.get("help_text"):
            self.help_text = "IPv4 çš„ IP æˆ–è€…å­ç½‘å½¢å¼å­—ç¬¦ä¸²"

    def to_internal_value(self, data):
        pass

class CreateRuleSerializer(serializers.Serializer):
    """
    ä¸€æ¡è§„åˆ™å¯ä»¥å°ç¦ä¹Ÿå¯ä»¥é™åˆ¶é¢‘ç‡ï¼Œå°ç¦çš„æ—¶å€™ï¼Œä¸éœ€è¦ä¼ é€’ e å’Œ f å­—æ®µã€‚
    """
    a = serializers.IntegerField(allow_null=True, required=False)
    b = serializers.CharField(allow_null=True, required=False)
    d = serializers.CharField(allow_null=True, required=False)
    d = serializers.ChoiceField(choices=[RuleAction.forbid, RuleAction.limit_rate])
    e = serializers.IntegerField(required=False, allow_null=True, min_value=1)
    f = serializers.IntegerField(required=False, allow_null=True, min_value=1)
    g = serializers.CharField(max_length=128, allow_blank=True, required=False)
    h = serializers.ListField(child=IPOrSubnetField())
```

ä¸‹é¢æ˜¯æˆ‘ä»¬ç”Ÿæˆçš„è¡¨æ ¼æ–‡æ¡£

æ•°æ®æ ¼å¼

> ä¸€æ¡è§„åˆ™å¯ä»¥å°ç¦ä¹Ÿå¯ä»¥é™åˆ¶é¢‘ç‡ï¼Œå°ç¦çš„æ—¶å€™ï¼Œä¸éœ€è¦ä¼ é€’ e å’Œ f å­—æ®µã€‚

|å­—æ®µå|æ•°æ®ç±»å‹|æ˜¯å¦å¿…å¡«/é»˜è®¤å€¼|NULL|å…¶ä»–|
|:--|:-:|:-:|:-:|:-:|
|a | æ•´å‹æ•°å­— | éå¿…å¡«/æ— é»˜è®¤å€¼ | True |  -  | 
|b | å­—ç¬¦ä¸² | éå¿…å¡«/æ— é»˜è®¤å€¼ | True |  -  | 
|c | å­—ç¬¦ä¸² | éå¿…å¡«/æ— é»˜è®¤å€¼ | True |  -  | 
|d | æŒ‡å®šé€‰é¡¹ | å¿…å¡« | False | é€‰é¡¹æ˜¯: ['forbid', 'limit_rate'] | 
|e | æ•´å‹æ•°å­— | éå¿…å¡«/æ— é»˜è®¤å€¼ | True | æœ€å°å€¼: 1;  | 
|f | æ•´å‹æ•°å­— | éå¿…å¡«/æ— é»˜è®¤å€¼ | True | æœ€å°å€¼: 1;  | 
|g | å­—ç¬¦ä¸² | éå¿…å¡«/æ— é»˜è®¤å€¼ | False | æœ€å¤§é•¿åº¦: 128; æœ€å°é•¿åº¦: 0ï¼›  | 
|h | åˆ—è¡¨ | å¿…å¡« | False |  è¯¦è§ä¸‹æ–¹è¡¨æ ¼ | 

h

|å­—æ®µå|æ•°æ®ç±»å‹|æ˜¯å¦å¿…å¡«/é»˜è®¤å€¼|NULL|å…¶ä»–|
|:--|:-:|:-:|:-:|:-:|
|å­å­—æ®µ | å­—ç¬¦ä¸² | å¿…å¡« | False | IPv4 çš„ IP æˆ–è€…å­ç½‘å½¢å¼å­—ç¬¦ä¸²;  | 


è¿™ä¸ªè¡¨æ ¼åŒ…å«äº†å­—æ®µåã€æ•°æ®ç±»å‹ã€æ•°æ®æ ¼å¼ã€å­—æ®µé¢å¤–è¯´æ˜ç­‰å‡ éƒ¨åˆ†ä¿¡æ¯ã€‚

 - ä¸€ä¸ª serializer çš„æ‰€æœ‰å­—æ®µå¯ä»¥åœ¨ `serializer.fields.items()` ä¸­å¾—åˆ°ï¼Œåªè¦éå†ä¸€ä¸‹æ‰€æœ‰çš„å­—æ®µå°±ä¸éš¾å†é’ˆå¯¹æ€§çš„å¤„ç†ã€‚
 - å­—æ®µçš„ç±»å‹å¾ˆå®¹æ˜“æ¨æ–­ï¼Œ`is_instance(field, serializers.IntegerField)` ç­‰é€ä¸ªçš„æ¯”è¾ƒå°±å¯ä»¥çŸ¥é“ã€‚
 - å‡ ä¹æ‰€æœ‰çš„å­—æ®µéƒ½æ”¯æŒ `required` å’Œ `null` å‚æ•°ï¼Œä»£è¡¨æ˜¯å¦å…è®¸ä¸ä¼ é€’è¯¥å­—æ®µå’Œæ˜¯å¦å…è®¸è¯¥å­—æ®µçš„å€¼ä¸º `null`ã€‚å¯¹äºå­—ç¬¦ä¸²ç±»å‹å’Œæ•°æ®ç±»å‹çš„å­—æ®µç­‰ï¼Œè¿˜æ”¯æŒ `max_length / max_value` å’Œ `min_length / min_value` å‚æ•°ï¼Œä»£è¡¨æ•°æ®çš„èŒƒå›´ï¼Œå…¶ä»–çš„ä¸ªåˆ«æ ¼å¼é™åˆ¶å¯ä»¥å‚è€ƒä¸‹ DRF çš„æºç ã€‚
 - æœ‰çš„å­—æ®µéœ€è¦é¢å¤–è¯´æ˜æ‰æ–¹ä¾¿ç†è§£ï¼Œæˆ–è€…æœ‰äº›å­—æ®µæ˜¯äº’æ–¥çš„ï¼Œä¸å¯ä»¥åŒæ—¶ä¼ é€’ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯è¦æ”¯æŒåœ¨ä»£ç ä¸­è‡ªæˆ‘æè¿°çš„åŠŸèƒ½ï¼Œè¿™äº›è¯´æ˜æœ‰ä¸¤å¤„æ¥æºï¼Œä¸€ä¸ªæ˜¯ serializer çš„ `doc string`ï¼Œå¦ä¸€ä¸ªæ˜¯ field çš„ `help_text` å±æ€§ã€‚

åœ¨å•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼ŒClient ä¼šä¼ é€’ä¸€ä¸ªç‰¹æ®Šçš„ HTTP å¤´ï¼Œè¿™æ · `@validate_serializer` å°±çŸ¥é“æ˜¯å¦è¦ç”Ÿæˆ serializer çš„æ–‡æ¡£äº†ã€‚

### APIæ•°æ®çš„æ–‡æ¡£

ä¸€ä¸ª API ä»…ä»…æœ‰æ•°æ®æ ¼å¼çš„è¦æ±‚æ˜¯ä¸å¤Ÿçš„ï¼Œæœ€å¥½è¿˜èƒ½å¤Ÿæä¾›ä¸€äº›å¸¸è§çš„æ­£ç¡®å’Œé”™è¯¯ä½¿ç”¨çš„ä¾‹å­ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥å¸®åŠ©ç”¨æˆ·å»æ›´å¥½çš„ç†è§£ API çš„ç”¨é€”ï¼Œå•å…ƒæµ‹è¯•çš„æµ‹è¯•ç”¨ä¾‹å°±æ˜¯è¿™äº›ç¤ºä¾‹æœ€å¥½çš„æ¥æºã€‚

ä¸€ä¸ªå…¸å‹çš„å•å…ƒæµ‹è¯•æ˜¯è¿™æ ·å­çš„

```python
class ACLAPITest(APITestCase):
    @document
    def test_create_acl_rule(self):
        """
        åˆ›å»º acl è§„åˆ™ï¼Œåªæœ‰ cidr
        """
        resp = self.client.post(self.url, data=self.base_rule)
        self.assertSuccess(resp)
        ...        
        return resp
    
    @document
    def test_edit_acl_rule(self):
        """
        ç¼–è¾‘ acl è§„åˆ™
        """
        rule_id = self.test_create_acl_rule_ip().data["data"]["id"]
        ...
        resp = self.client.put(self.url, data=new_rule)
        self.assertSuccess(resp)
        ...
```

è¿™é‡Œæµ‹è¯•åˆ›å»ºå’Œç¼–è¾‘ ACL è§„åˆ™ã€‚`@document` æ˜¯æ ‡è®°è¿™ä¸ªæµ‹è¯•ç”¨ä¾‹è¦ç”Ÿæˆæ–‡æ¡£ã€‚æˆ‘ä»¬é€šè¿‡ä¿®æ”¹ Client çš„å±æ€§æ¥å®ç°ã€‚

```python
def document(method):
    @functools.wraps(method)
    def handle(*args, **kwargs):
        if args[0]._testMethodName == method.__name__:
            args[0].client.test_method_name = args[0]._testMethodName
            args[0].client.doc = method.__doc__
            args[0].client.running_module = method.__module__.split(".")[0]
        ret = method(*args, **kwargs)
        return ret
    return handle
```

è¦æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰ä¿®é¥°åœ¨å½“å‰æ­£åœ¨æ‰§è¡Œçš„æµ‹è¯•ä¸Šï¼Œæ‰ä¼šå»æ›´æ–°è¿™äº›å±æ€§ï¼Œå¦åˆ™è¿è¡Œ `test_edit_acl_rule` çš„æ—¶å€™ï¼Œ`test_create_acl_rule` ä¼šæŠŠ Client çš„å±æ€§æ”¹é”™ã€‚

æµ‹è¯•ä¸­çš„ Client å°±æ˜¯ä¸€ä¸ªç”Ÿæˆ HTTP è¯·æ±‚ï¼Œç„¶åæ¨¡æ‹Ÿå‘é€è¯·æ±‚çš„ç»„ä»¶ï¼Œè¦æƒ³è®°å½•ä¸‹è¯·æ±‚å’Œå“åº”çš„å†…å®¹ï¼Œæ›¿æ¢æ‰ DRF åŸç”Ÿ Client æ˜¯å¿…é¡»çš„ï¼Œå½“ç„¶è¿™ä¸ªä¹Ÿä¸éš¾ï¼Œåªè¦ç»§æ‰¿åŸæ¥çš„ Clientï¼Œé‡è½½ç›¸å…³æ–¹æ³•ï¼Œè®°å½•è¯·æ±‚æ•°æ®ï¼Œç„¶åè°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼Œå†è®°å½•å“åº”æ•°æ®å°±å¯ä»¥äº†ã€‚

```python
class DocumentAPIClient(APIClient):
    test_method_name = ""
    doc = ""
    running_module = ""
    
    def _request(self, method, *args, **kwargs):
        make_doc = self.test_method_name == inspect.stack()[2].function
        if make_doc:
            kwargs["serializer_gen_doc"] = True
        # kwargs ä¸­çš„é¢å¤–å‚æ•°ï¼Œåœ¨ view ä¸­ request.META ä¸­å¯ä»¥å–åˆ°ï¼Œç±»ä¼¼é¢å¤–çš„ HTTP å¤´
        resp = getattr(super(), method)(*args, **kwargs)

        if make_doc:
            # è®°å½• API è¯·æ±‚å’Œå“åº”
            pass

class APITestCase(TestCase):
    client_class = DocumentAPIClient
```

æœ‰å‡ ç‚¹æ˜¯è¦æ³¨æ„çš„

 - æµ‹è¯•ç”¨ä¾‹å­˜åœ¨åµŒå¥—å…³ç³»çš„æ—¶å€™ï¼Œæ¯”å¦‚ `test_edit_acl_rule` ä¸­ï¼Œæˆ‘ä»¬åªå…³å¿ƒæœ¬æµ‹è¯•ä¸­å‘é€çš„è¯·æ±‚ï¼Œè€Œä¸å…³å¿ƒè°ƒç”¨çš„ `test_create_acl_rule` ä¸­å‘é€çš„è¯·æ±‚ï¼Œæ‰€ä»¥ Client éœ€è¦æ ¹æ®ä»£ç è°ƒç”¨æ ˆæ¥åˆ¤æ–­è‡ªå·±çš„ä½ç½®ã€‚

   è¯·æ±‚æ˜¯åœ¨å½“å‰æ­£åœ¨æ‰§è¡Œçš„ `test_create_acl_rule` ä¸­å‘å‡ºçš„ï¼Œé‚£ä¹ˆå‡½æ•°æ ˆæ˜¯

     - self._request(0)
     - self.post...(1)
     - test_create_acl_rule(2)

   `test_edit_acl_rule` ä¸­è°ƒç”¨äº† `test_create_acl_rule` æ—¶ï¼Œ`self.test_method_name == "test_edit"`ï¼Œè€Œå‡½æ•°æ ˆæ˜¯
   
     - self._request(0)
     - self.post...(1)
     - test_create_acl_rule(2)
     - test_edit_acl_rule(3)

 - ä¸æ˜¯æ‰€æœ‰çš„ API éƒ½æ˜¯å¯ JSON çš„ï¼Œæ¯”å¦‚ä¸Šä¼ æˆ–è€…ä¸‹è½½æ–‡ä»¶çš„è¯·æ±‚ï¼Œç”Ÿæˆæ–‡æ¡£çš„æ—¶å€™éœ€è¦ç‰¹ä¾‹å¤„ç†ä¸‹ã€‚å¯ä»¥å†™ä¸€ä¸ªè‡ªå®šä¹‰çš„ JSON Encoder æ¥å®ç°ã€‚

   ```python
    class MultipartToJsonLikeEncoder(json.JSONEncoder):
        def default(self, o):
            if isinstance(o, io.BytesIO) or isinstance(o, io.StringIO):
                return "<æ–‡ä»¶ä¸Šä¼  ğŸ’¾ >"
            return json.JSONEncoder.default(self, o)
   ```
   
- ç”Ÿæˆæ–‡æ¡£çš„æ—¶å€™è¦æ’åºï¼Œå°†å“åº”æ­£ç¡®çš„æ’åœ¨å‰é¢ï¼Œå“åº”é”™è¯¯çš„æ’åœ¨åé¢ã€‚

## æ€»ç»“

è§£å†³äº†å·²æœ‰çš„é—®é¢˜ï¼Œè€Œä¸”é¼“åŠ±å¼€å‘è€…è®¤çœŸçš„å»å†™æ›´è§„èŒƒçš„æµ‹è¯•

 - ä¸ºäº†ç”Ÿæˆæ–‡æ¡£ï¼Œè‡³å°‘ä¼šå†™ä¸€ä¸ªç®€åŒ–ç‰ˆæµ‹è¯•ï¼Œæ€»æ¯”æ²¡æœ‰æµ‹è¯•è¦å¥½
 - ä¸€ä¸ªæµ‹è¯•åªå¹²ä¸€ä»¶äº‹æƒ…ï¼Œå¦åˆ™ç”Ÿæˆçš„æ–‡æ¡£ä¼šæœ‰é‡å¤
 - æµ‹è¯•ä¸­ä¼šå†™æ³¨é‡Šæ ‡æ˜æµ‹è¯•çš„ç”¨é€”

